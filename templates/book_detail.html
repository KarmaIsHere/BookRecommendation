{% extends "base.html" %}

{% block title %}Home | Bookie{% endblock %}

{% block content %}
    <body>
    <header>
        <h1>Book Detail</h1>
    </header>

    <div class="container">
        <a href="{{ url_for('browse') }}" class="back-link">‚Üê Back to Browse</a>
        <div class="book-container">
            <img id="bookImage" class="book-image" src="" alt="Book cover">
            <div>
                <h2 id="title">Loading...</h2>
                <p id="authors"></p>
                <div id="genres" class="genre-tags"></div>
                <p id="summary" class="summary"></p>
                <a id="textUrl" class="text-button" target="_blank">Read Full Text</a>
            </div>
        </div>
    </div>

    {% block scripts %}
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const bookId = {{ book_id | tojson }};

                axios.get(`http://localhost:8080/api/book/details/${bookId}`)
                    .then(response => {
                        const book = response.data;
                        document.getElementById('title').innerText = book.title;
                        document.getElementById('authors').innerText = "by " + book.authors.join(', ');
                        document.getElementById('summary').innerText = book.summary || "No summary available.";
                        document.getElementById('bookImage').src = book.image || "https://via.placeholder.com/200x300?text=No+Cover";
                        document.getElementById('textUrl').href = book.textUrl || "#";
                        document.getElementById('textUrl').style.display = book.textUrl ? "inline-block" : "none";

                        const genresDiv = document.getElementById('genres');
                        genresDiv.innerHTML = '';
                        book.genres.forEach(genre => {
                            const tag = document.createElement('span');
                            tag.classList.add('genre-tag');
                            tag.innerText = genre;
                            genresDiv.appendChild(tag);
                        });
                    })
                    .catch(err => {
                        document.querySelector('.container').innerHTML = '<p class="error">Book not found. Please try again later.</p>';
                        console.error('Error loading book:', err);
                    });
            });
        </script>
    {% endblock %}
{% endblock %}
